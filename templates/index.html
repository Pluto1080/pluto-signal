<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TERMINAL: PLUTO</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <style>
        @import url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_six@1.2/DungGeunMo.woff');
        * { box-sizing: border-box; }
        ::-webkit-scrollbar { display: none; }
        body { background: #050505; margin: 0; display: flex; align-items: center; justify-content: center; height: 100vh; overflow: hidden; font-family: 'DungGeunMo', monospace; }

        .monitor-frame {
            width: 95vw; height: 90vh; max-width: 1000px;
            background: radial-gradient(circle at 30% 30%, #00a8a8 0%, #006666 100%);
            border-radius: 60px; padding: 35px; position: relative; display: flex; align-items: center; justify-content: center;
            box-shadow: inset 0 0 30px rgba(255,255,255,0.2), 0 30px 60px rgba(0,0,0,0.8), 0 0 0 10px #004d4d;
        }

        @media (max-width: 768px) {
            .monitor-frame { width: 98vw; height: 95vh; padding: 15px; border-radius: 30px; }
            .result-split-row { flex-direction: column !important; }
            #loading-text { font-size: 1.2rem !important; }
        }

        .screen-container { width: 100%; height: 100%; background: #000; border-radius: 30px; position: relative; overflow: hidden; border: 12px solid #111; }
        .crt-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 100; pointer-events: none;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.05), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.05));
            background-size: 100% 3px, 3px 100%; animation: ambient-light 4s ease-in-out infinite;
        }
        @keyframes ambient-light { 0%, 100% { opacity: 0.7; } 50% { opacity: 1; } }

        .screen-content { width: 100%; height: 100%; background: radial-gradient(circle at center, #222 0%, #000 100%); position: relative; animation: screen-pulse 8s ease-in-out infinite; }
        @keyframes screen-pulse { 0%, 100% { filter: brightness(0.9); } 50% { filter: brightness(1.1); } }

        .screen { position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 25px; opacity: 0; pointer-events: none; transition: opacity 0.5s; }
        .screen.active { opacity: 1; pointer-events: auto; z-index: 10; }

        h1.shiny-title { font-size: 1.8rem; text-align: center; background: linear-gradient(90deg, #00ff41, #fff, #00ff41); background-size: 200% auto; -webkit-background-clip: text; color: transparent; animation: shine 3s linear infinite; }
        @keyframes shine { to { background-position: 200% center; } }

        .star { position: absolute; background: #FFD700; border-radius: 0; opacity: 0; box-shadow: -2px -2px 0 #FFD700; animation: shooting-star linear infinite; }
        @keyframes shooting-star { 0% { transform: translate(0, 0); opacity: 0; } 10% { opacity: 1; } 100% { transform: translate(100vw, 100vh); opacity: 0; } }

        input, select { background: rgba(0,0,0,0.7); border: 2px solid #00ff41; color: #00ff41; padding: 10px; width: 100%; font-family: 'DungGeunMo'; outline: none; }
        button.cyber-btn { background: #00ff41; color: #000; border: 4px solid #008f11; padding: 15px; width: 100%; font-family: 'DungGeunMo'; font-weight: bold; cursor: pointer; box-shadow: 4px 4px 0 #004411; margin-top: 15px; }
        button.cyber-btn:hover { background: #ff00ff; border-color: #aa00aa; box-shadow: 4px 4px 0 #550055; color: #fff; }

        .result-box { border: 3px solid #00ff41; padding: 15px; background: rgba(0,0,0,0.8); margin-bottom: 15px; width: 100%; }
        .result-box h2 { font-size: 1rem; color: #ff00ff; border-bottom: 1px solid #00ff41; margin: 0 0 10px 0; }
        .result-content { font-size: 0.95rem; line-height: 1.6; color: #00ff41; }
    </style>
</head>
<body>
    <div class="monitor-frame">
        <div class="screen-container">
            <div class="crt-overlay"></div>
            <div class="screen-content">
                <section id="screen-input" class="screen active">
                    <div style="width:100%; max-width:450px;">
                        <h1 class="shiny-title">ACCESS: PLUTO</h1>
                        <input type="text" id="userName" placeholder="이름 입력" style="margin-bottom:10px;">
                        <div style="display: flex; gap: 10px; margin-bottom:10px;">
                            <input type="date" id="birthDate" max="9999-12-31">
                            <input type="time" id="birthTime" lang="en-GB">
                        </div>
                        <div id="map" style="height:150px; border:3px solid #00ff41; filter:invert(100%);"></div>
                        <button class="cyber-btn" onclick="startAnalysis()">INITIATE_SEQUENCE</button>
                    </div>
                </section>

                <section id="screen-loading" class="screen">
                    <div id="loading-text" style="color:#FFD700; text-align:center;">별의 소리를 관측하는 중</div>
                </section>

                <section id="screen-personality" class="screen">
                    <div style="width:100%; max-width:600px; max-height:90%; overflow-y:auto;">
                        <h1 class="shiny-title" style="font-size:1.4rem;">CORE_DATA_ANALYZED</h1>
                        <div class="result-box"><h2>>> CORE_PERSONALITY</h2><div id="res-personality" class="result-content"></div></div>
                        <div class="result-split-row" style="display: flex; gap: 10px;">
                            <div class="result-box" style="flex:1; border-color:#0044ff;"><h2 style="color:#0044ff;">[+] STRENGTHS</h2><div id="res-pros" class="result-content"></div></div>
                            <div class="result-box" style="flex:1; border-color:#ff0055;"><h2 style="color:#ff0055;">[-] WEAKNESSES</h2><div id="res-cons" class="result-content"></div></div>
                        </div>
                        <button class="cyber-btn" onclick="switchScreen('screen-selection')">PROCEED_TO_2026_FORTUNE</button>
                    </div>
                </section>

                <section id="screen-selection" class="screen">
                    <div style="width:100%; max-width:500px; text-align:center;">
                        <h1 class="shiny-title">CHOOSE_YOUR_DESTINY</h1>
                        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:15px; width:100%;">
                            <button class="cyber-btn" style="border-color:#ff00ff; color:#ff00ff;" onclick="showFortune('love')">[♥] LOVE</button>
                            <button class="cyber-btn" style="border-color:#ffd700; color:#ffd700;" onclick="showFortune('money')">[$] MONEY</button>
                            <button class="cyber-btn" style="border-color:#00ffff; color:#00ffff;" onclick="showFortune('career')">[!] CAREER</button>
                            <button class="cyber-btn" onclick="location.reload()">RESTART</button>
                        </div>
                    </div>
                </section>

                <section id="screen-fortune-detail" class="screen">
                    <div style="width:100%; max-width:500px;">
                        <h1 id="fortune-title" class="shiny-title" style="font-size:1.4rem;"></h1>
                        <div id="fortune-box" class="result-box"><h2 id="fortune-sub"></h2><div id="res-fortune-content" class="result-content"></div></div>
                        <button class="cyber-btn" onclick="switchScreen('screen-selection')">GO_BACK</button>
                    </div>
                </section>
            </div>
        </div>
    </div>

    <script>
        let selectedLat = 37.5665, selectedLon = 126.9780, globalData = null;
        const map = L.map('map', { zoomControl: false }).setView([selectedLat, selectedLon], 6);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
        let marker = L.marker([selectedLat, selectedLon]).addTo(map);
        map.on('click', (e) => { selectedLat = e.latlng.lat; selectedLon = e.latlng.lng; marker.setLatLng(e.latlng); });

        function switchScreen(id) { document.querySelectorAll('.screen').forEach(s => s.classList.remove('active')); document.getElementById(id).classList.add('active'); }

        function startAnalysis() {
            const name = document.getElementById('userName').value, date = document.getElementById('birthDate').value, time = document.getElementById('birthTime').value;
            if(!name || !date || !time) return alert("데이터 입력 필요");
            switchScreen('screen-loading');
            const screen = document.querySelector('.screen-content');
            for(let i=0; i<30; i++) {
                let s = document.createElement('div'); s.className = 'star';
                const size = Math.random()*8+2; s.style.width = s.style.height = `${size}px`;
                s.style.left = `${Math.random()*120-40}vw`; s.style.top = `${Math.random()*120-40}vh`;
                s.style.animationDuration = `${Math.random()*7+5}s`; screen.appendChild(s);
            }
            fetch('/analyze', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ name, date, time, lat: selectedLat, lon: selectedLon }) })
            .then(res => res.json()).then(data => {
                document.querySelectorAll('.star').forEach(s => s.remove());
                globalData = data;
                document.getElementById('res-personality').innerText = data.personality;
                document.getElementById('res-pros').innerText = data.pros;
                document.getElementById('res-cons').innerText = data.cons;
                switchScreen('screen-personality');
            });
        }

        function showFortune(type) {
            const t = document.getElementById('fortune-title'), st = document.getElementById('fortune-sub'), c = document.getElementById('res-fortune-content'), b = document.getElementById('fortune-box');
            if(type === 'love') { t.innerText = "2026_LOVE"; st.innerText = "[♥] RELATION_LOG"; c.innerText = globalData.fortune_2026.love; b.style.borderColor = "#ff00ff"; st.style.color = "#ff00ff"; }
            else if(type === 'money') { t.innerText = "2026_MONEY"; st.innerText = "[$] WEALTH_STATUS"; c.innerText = globalData.fortune_2026.money; b.style.borderColor = "#ffd700"; st.style.color = "#ffd700"; }
            else if(type === 'career') { t.innerText = "2026_CAREER"; st.innerText = "[!] PATH_UPDATE"; c.innerText = globalData.fortune_2026.career; b.style.borderColor = "#00ffff"; st.style.color = "#00ffff"; }
            switchScreen('screen-fortune-detail');
        }
    </script>
</body>
</html>
